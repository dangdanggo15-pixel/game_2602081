<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Dot Magic Stacker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: #ffd700; pointer-events: none; text-shadow: 2px 2px #000; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; color: white; font-size: 2em; display: none; z-index: 100; }
        button { padding: 10px 20px; background: #8b4513; color: #ffd700; border: 2px solid #ffd700; cursor: pointer; font-family: inherit; }
    </style>
</head>
<body>

<div id="ui">
    <h1>DOT MAGIC STACKER</h1>
    <p>SCORE: <span id="scoreText">0</span></p>
</div>

<div id="msg">
    <h2 style="color: #ff4500;">GAME OVER</h2>
    <button onclick="location.reload()">RETRY</button>
</div>

<script>
// 1. 물리 엔진 초기화
const { Engine, Render, Runner, Bodies, Composite, Events } = Matter;
const engine = Engine.create();
const world = engine.world;

const render = Render.create({
    element: document.body,
    engine: engine,
    options: {
        width: window.innerWidth,
        height: window.innerHeight,
        wireframes: false,
        background: 'transparent' // CSS 배경을 쓰기 위해 투명 설정
    }
});

// 배경 이미지 설정 (사용자가 준비할 bg.png)
document.body.style.backgroundImage = "url('bg.png')";
document.body.style.backgroundSize = "cover";

Render.run(render);
const runner = Runner.create();
Runner.run(runner, engine);

// 2. 바닥 생성 (ground.png)
const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight - 50, 500, 60, { 
    isStatic: true, 
    render: { 
        sprite: { texture: 'ground.png' } // 이미지가 없으면 기본 색상으로 나옵니다
    } 
});
Composite.add(world, ground);

let score = 0;
let isGameOver = false;

// 3. 효과음 함수 (파일 없이 브라우저가 직접 생성)
function playBeep(freq) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.frequency.value = freq;
    oscillator.start();
    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
    oscillator.stop(audioCtx.currentTime + 0.1);
}

// 4. 클릭 시 아이템 생성
window.addEventListener('mousedown', (e) => {
    if (isGameOver) return;

    // 1~5번 아이템 중 무작위 선택
    const itemNum = Math.floor(Math.random() * 5) + 1;
    const itemSize = 60 + Math.random() * 20; // 크기도 약간씩 랜덤하게

    const item = Bodies.rectangle(e.clientX, 100, itemSize, itemSize, {
        restitution: 0.3,
        friction: 0.5,
        render: {
            sprite: { 
                texture: `item${itemNum}.png`,
                xScale: itemSize / 100, // 이미지 크기 자동 맞춤
                yScale: itemSize / 100
            }
        }
    });

    Composite.add(world, item);
    playBeep(400 + (score * 20)); // 쌓을수록 소리가 높아짐
    score++;
    document.getElementById('scoreText').innerText = score;
});

// 5. 게임 오버 체크
Events.on(engine, 'afterUpdate', () => {
    const bodies = Composite.allBodies(world);
    bodies.forEach(body => {
        if (!body.isStatic && body.position.y > window.innerHeight) {
            if (!isGameOver) {
                isGameOver = true;
                playBeep(100); // 웅장한(?) 실패 효과음
                document.getElementById('msg').style.display = 'block';
            }
        }
    });
});

window.addEventListener('resize', () => {
    render.canvas.width = window.innerWidth;
    render.canvas.height = window.innerHeight;
});
</script>
</body>
</html>
